<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SMC BTC/USDT Live Chart</title>
  <script src="https://unpkg.com/lightweight-charts@4.0.0/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    body { font-family: Arial, sans-serif; }
    #chart { width: 100%; height: 600px; }
  </style>
</head>
<body>
  <h2>ðŸ“ˆ BTC/USDT SMC Live Chart</h2>
  <div id="chart"></div>
  <script>
    const chart = LightweightCharts.createChart(document.getElementById('chart'), {
      layout:{backgroundColor:'#fff', textColor:'#000'},
      grid:{vertLines:{color:'#eee'},horzLines:{color:'#eee'}},
      timeScale:{timeVisible:true, secondsVisible:false}
    });
    const series = chart.addCandlestickSeries();

    async function fetchData(){
      const res = await fetch('http://localhost:8000/api/data');
      const {candles, signals} = await res.json();
      series.setData(candles);
      signals.forEach(sig=>{
        chart.addShape({
          time: sig.time,
          price: sig.entry,
          shape: sig.direction==='long'?'arrow_up':'arrow_down',
          color: sig.direction==='long'?'green':'red',
          text: sig.direction.toUpperCase()
        });
        chart.addPriceLine({price: sig.ob_zone[0], color:'blue', lineWidth:1, lineStyle:2, title:'OB low'});
        chart.addPriceLine({price: sig.ob_zone[1], color:'blue', lineWidth:1, lineStyle:2, title:'OB high'});
        chart.addPriceLine({price: sig.fvg_zone[0], color:'orange', lineWidth:1, title:'FVG high'});
        chart.addPriceLine({price: sig.fvg_zone[1], color:'orange', lineWidth:1, title:'FVG low'});
      });
    }
    fetchData();
    setInterval(fetchData,15000);
  </script>
</body>
</html>
